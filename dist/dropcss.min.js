/*! https://github.com/leeoniya/dropcss (v1.0.0) */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).dropcss=t()}(this,function(){"use strict";var e=1,t=2,r=3,n=new Set("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),a=/<!doctype[^>]*>|<!--[\s\S]*?-->|<script[^>]*>[\s\S]*?<\/script>|<style[^>]*>[\s\S]*?<\/style>|<link[^>]*>|<meta[^>]*>/gim,s=/([\w-]+)(?:="([^"]*)"|='([^']*)'|=(\S+))?/gm,i={TAG_HEAD:/\s*<([a-z0-9_-]+)(?:\s+([^>]*))?>\s*/my,TEXT:/\s*[^<]*/my,TAG_CLOSE:/\s*<\/[a-z0-9_-]+>\s*/my};var c=new Set;function o(e,t,r){return{tagName:t,attributes:r,classList:null!=r&&r.has("class")?new Set(r.get("class").split(/\s+/g)):c,parentNode:e,childNodes:[]}}function l(e,t){if(null!=e){var r=e._ofTypes=e._ofTypes||{};if(!(t in r)){var n=0;r[t]=e.childNodes.filter(function(e){if(e.tagName==t)return e._typeIdx=n++,!0})}return r[t]}return null}var u=function(l){var u=function(a){var c,o=0,l=[];function u(e){for(var t in o=e.lastIndex,i)i[t].lastIndex=o}function d(){if(null!=(c=i.TAG_CLOSE.exec(a)))return u(i.TAG_CLOSE),void l.push(r);if(null==(c=i.TAG_HEAD.exec(a)))null!=(c=i.TEXT.exec(a))&&u(i.TEXT);else{u(i.TAG_HEAD);var o=c[1];l.push(e,o);var d=c[2];if(null!=d){for(var f,h=new Map;f=s.exec(d);)h.set(f[1],(f[2]||f[3]||f[4]||"").trim());l.push(t,h)}n.has(o)&&l.push(r)}}for(;o<a.length;)d();return u({lastIndex:0}),l}(l=l.replace(a,"")),d={nodes:[],tag:new Set(["*"]),class:new Set,attr:new Set};!function(n,a){for(var s,i=o(null,"root",c),l=0;l<n.length;l++)switch(n[l]){case e:var u=n[++l],d=c;n[l+1]===t&&(d=n[l+=2]),s=i.childNodes.length,i.childNodes.push(i=o(i,u,d)),a(i,s);break;case r:i=i.parentNode}}(u,function(e,t){return function(e,t,r){e.idx=t;var n=e.attributes;r.tag.add(e.tagName),e.classList.forEach(function(e){return r.class.add(e)}),n.has("id")&&r.attr.add("[id="+n.get("id")+"]"),n.has("type")&&r.attr.add("[type="+n.get("type")+"]"),r.nodes.push(e)}(e,t,d)});return d},d=/\s*\/\*[\s\S]*?\*\/\s*/gm,f=/\s*[>~+]\s*|\s+/g,h=1,p=2,x=3,v=4,m=5;function g(e,t){for(var r="",n=1;"{"==e[t]?n++:"}"==e[t]&&n--,0!=n;)r+=e[t++];return r}function y(e){var t,r={RULE_HEAD:/\s*([^{;]+?)\s*[{;]\s*/my,RULE_TAIL:/\s*([^}]*?)\s*\}/my,AT_TAIL:/\s*\}/my,RULE_FULL:/\s*([^{]*?)\{([^}]+?)\}/my},n=0,a=0,s=[];function i(e){for(var t in a=e.lastIndex,r)r[t].lastIndex=a}function c(){if(n>0&&null!=(t=r.AT_TAIL.exec(e)))return n--,s.push(p),void i(r.AT_TAIL);if(null!=(t=r.RULE_HEAD.exec(e))){var c=t[1];if(i(r.RULE_HEAD),"@"==c[0])switch(c.match(/@[a-z-]+/)[0]){case"@media":case"@supports":case"@document":n++,s.push(h,c);break;case"@import":case"@charset":case"@namespace":s.push(m,c+";");break;default:n++;var o=g(e,a);i({lastIndex:a+o.length}),s.push(h,c,m,o)}else s.push(x,(l=t[1],(u=l.split(/\s*,\s*/gm)).push(u.map(function(e){return function(e){return e.replace(/:?:[a-z-]+(?:\([^()]+\))?/gm,"")}(e).trim().replace(/(\.|#|\[)/gm," $1").replace(/\]/gm,"] ").trim().split(f)})),u)),t=r.RULE_TAIL.exec(e),s.push(v,t[1]),i(r.RULE_TAIL)}else a=e.length;var l,u}for(;a<e.length;)c();return s}function b(e,t){return t==e.tagName||"*"==t}function k(e,t,r,n){n=n||"=";var a=e.attributes;if(a.has(t)){var s=a.get(t);switch(n){case"=":return null==r||r==s;case"*=":return-1!=s.indexOf(r);case"^=":return s.startsWith(r);case"$=":return s.endsWith(r)}}return!1}function T(e,t){return e.classList.has(t)}function E(e,t){return e.some(function(e){return function e(t,r){var n,a,s,i,c,o;for(;r.idx>-1;){switch(t[r.idx]){case"_":n=t[--r.idx],o=b(r.node,n),r.idx--;break;case"#":a=t[--r.idx],o=k(r.node,"id",a,"="),r.idx--;break;case".":n=t[--r.idx],o=T(r.node,n),r.idx--;break;case"[":n=t[--r.idx],s=t[--r.idx],a=t[--r.idx],o=k(r.node,n,a,s),r.idx--;break;case":":n=t[--r.idx],a=t[--r.idx];var u=r.node,d=u.tagName;c=u.idx;var f=(i=u.parentNode)?i.childNodes.length:1,h=void 0;switch(n){case"not":o=!e(a,{node:r.node,idx:a.length-1});break;case"first-child":o=0==c;break;case"last-child":o=c==f-1;break;case"only-child":o=1==f;break;case"nth-child":o=w(c+1,a);break;case"nth-last-child":o=w(f-c,a);break;case"first-of-type":h=l(i,d),o=0==u._typeIdx;break;case"last-of-type":h=l(i,d),o=u._typeIdx==h.length-1;break;case"only-of-type":h=l(i,d),o=1==h.length;break;case"nth-of-type":h=l(i,d),o=w(u._typeIdx+1,a);break;case"nth-last-of-type":h=l(i,d),o=w(h.length-u._typeIdx,a)}r.idx--;break;case" ":for(c=--r.idx,o=!1;!o&&null!=(i=r.node.parentNode);)r.idx=c,r.node=i,o=e(t,r);break;case">":r.idx--,null!=(i=r.node.parentNode)?(r.node=i,o=e(t,r)):o=!1;break;case"+":r.idx--,null!=(i=r.node.parentNode)&&r.node.idx>0?(r.node=i.childNodes[r.node.idx-1],o=e(t,r)):o=!1;break;case"~":if(r.idx--,o=!1,c=r.node.idx,null!=(i=r.node.parentNode)&&c>0)for(var p=0;p<c&&!o;p++)r.node=i.childNodes[p],o=e(t,r)}if(!o)break}return o}(t,{idx:t.length-1,node:e})})}var _=/^([+-]?\d*)?n([+-]\d+)?$/;function w(e,t){var r;if("odd"==t)r=e%2==1;else if("even"==t)r=e%2==0;else if(/^\d+$/.test(t))r=e==+t;else{var n=function(e){var t=_.exec(e);if(null!=t){var r=t[1],n=t[2];return[r=null==r||"+"==r?1:"-"==r?-1:+r,n=null==n?0:+n]}return[0,0]}(t);r=function(e,t,r){if(t<0&&e<=0)return!1;if(-1===e)return r<=t;if(0===e)return r===t;if(1===e)return t<0||r>=t;var n=t%e;return n<0&&(n+=e),e>1?r>=t&&r%e===n:(e*=-1,r<=t&&r%e===n)}(n[0],n[1],e)}return r}var A=function(e,t){return E(e,Array.isArray(t)?t:function e(t){var r,n={IDENT:/([\w*-]+)/iy,ATTR:/([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/iy,PSEUDO:/([\w-]+)(?:\(([^)]*)\))?/iy,MODE:/\s*[:.#\[]\s*/iy,COMB:/\s*[>~+]\s*|\s+/iy},a=0,s=[],i=-1;function c(e){for(var t in a=e.lastIndex,n)n[t].lastIndex=a}function o(){var o=!1;if(r=n.COMB.exec(t)){o=!0;var l=r[0].trim();""==l&&(l=" "),s.push(l),c(n.COMB),i=a}else if(r=n.MODE.exec(t)){o=!0;var u=r[0].trim();c(n.MODE),":"==u?(r=n.PSEUDO.exec(t),s.splice(i+1,0,null!=r[2]&&"not"==r[1]?e(r[2]):r[2],r[1],u),c(n.PSEUDO)):"["==u?(r=n.ATTR.exec(t),s.splice(i+1,0,r[3],r[2],r[1],u),c(n.ATTR)):(r=n.IDENT.exec(t),s.push(r[1],u),c(n.IDENT))}else(r=n.IDENT.exec(t))&&(o=!0,s.push(r[1],"_"),c(n.IDENT));return o}for(;a<t.length;)o();return s}(t))},I=/\[([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/i,N=/:(?:first|last|nth|only|not)\b/;function L(e,t,r){for(var n=t.length-1;n>-1;n--){var a=t[n];r.has(a[2])||(s=e,i=a[0],c=a[1],o="",e=s.slice(0,i)+o+s.slice(i+c))}var s,i,c,o;return e}var S=function(e){return!0};return function(e){for(var t=u(e.html,!e.keepText),r=e.shouldDrop||S,n=y(e.css.replace(d,"")),a={},s=0;s<n.length;s++)if(n[s]===x){var i=n[s+1],c=i[i.length-1];s++;for(var o=0;o<c.length;o++){var l=c[o];e:for(var f=0;f<l.length;f++){var b=l[f],T=!1,E=void 0;if(""!=b){if(b in a)T=a[b];else switch(b[0]){case"#":E=b.substr(1),a[b]=T=t.attr.has("[id="+E+"]");break;case".":E=b.substr(1),a[b]=T=t.class.has(E);break;case"[":if(b.startsWith("[type="))a[b]=T=t.attr.has(b);else{var _=b.match(I);a[b]=T=t.nodes.some(function(e){return k(e,_[1],_[3],_[2])})}break;default:a[b]=T=t.tag.has(b)}if(!T){!0===r(i[o])?i[o]=null:a[i[o]]=!0;break e}}}}}for(var w=0;w<n.length;w++)n[w]===x&&(n[++w].length,n[w]=n[w].filter(function(e){if("string"==typeof e){if(e in a)return a[e];var n=(s=e).replace(/:?:[a-z-]+/gm,function(e){return s.startsWith("::")||!N.test(e)?"":e}).replace(/:[a-z-]+\(\)/gm,"");return""==n||(n in a?a[n]:a[n]=A(t.nodes,n)||!0!==r(e))}var s;return!1}));var D=function(e){for(var t="",r=0,n=0;n<e.length;n++)switch(e[n]){case x:var a=e[++n];(r=a.length)>0&&(t+=a.join());break;case v:r>0&&(t+="{"+e[++n]+"}");break;case h:t+=e[++n]+"{";break;case p:t+="}";break;case m:t+=e[++n]}return t.replace(/@[a-z-]+\s+[^{]+\{\s*\}/gm,"")}(n);return{css:D=function(e){for(var t,r=[],n=new Set,a=/@font-face[\s\S]+?font-family:\s*(['"\w-]+)[^}]+\}/gm;t=a.exec(e);){var s=t[1].replace(/['"]/gm,"");r.push([t.index,t[0].length,s])}for(var i=/font-family:([^;!}]+)/gm;t=i.exec(e);)r.some(function(e){return t.index>e[0]&&t.index<e[0]+e[1]})||t[1].trim().split(",").forEach(function(e){n.add(e.trim().replace(/['"]/gm,""))});return L(e,r,n)}(D=function(e){for(var t,r=[],n=new Set,a=/@(?:-\w+-)?keyframes\s+([\w-]+)\s*\{/gm;t=a.exec(e);){var s=g(e,a.lastIndex);r.push([t.index,t[0].length+s.length+1,t[1]])}for(var i=/animation(?:-name)?:([^;!}]+)/gm;t=i.exec(e);)t[1].trim().split(",").forEach(function(e){n.add(e.trim().match(/^[\w-]+/)[0])});return L(e,r,n)}(D))}}});
