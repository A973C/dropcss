/*! https://github.com/leeoniya/dropcss (v1.0.9-dev) */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).dropcss=t()}(this,function(){"use strict";function e(e,t,r){throw new Error(e+' parser stopped here: "'+t.substring(r,r+100)+'"')}var t=1,r=2,n=3,a=new Set("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),s=/<!doctype[^>]*>|<!--[\s\S]*?-->|<script[^>]*>[\s\S]*?<\/script>|<style[^>]*>[\s\S]*?<\/style>|<link[^>]*>|<meta[^>]*>/gim,i=/([\w-]+)(?:="([^"]*)"|='([^']*)'|=(\S+))?/gm,c={TAG_HEAD:/\s*<([\w-]+)(?:\s*([^>]*))?>\s*/imy,TEXT:/\s*[^<]*/my,TAG_CLOSE:/\s*<\/[\w-]+>\s*/imy};var o=new Set;function u(e,t,r){return{tagName:t,attributes:r,classList:null!=r&&r.has("class")?new Set(r.get("class").split(/\s+/g)):o,parentNode:e,childNodes:[]}}var l=[];function f(e,t){if(null!=e){var r=e._ofTypes=e._ofTypes||{};if(!(t in r)){var n=0;r[t]=e.childNodes.filter(function(e){if(e.tagName==t)return e._typeIdx=n++,!0})}return r[t]}return l}var d=function(l){var f=function(s){var o,u=0,l=[];function f(e){for(var t in u=e.lastIndex,c)c[t].lastIndex=u}function d(){if(null!=(o=c.TAG_CLOSE.exec(s)))return f(c.TAG_CLOSE),void l.push(n);if(null==(o=c.TAG_HEAD.exec(s)))null!=(o=c.TEXT.exec(s))&&f(c.TEXT);else{f(c.TAG_HEAD);var e=o[1];l.push(t,e);var u=o[2];if(null!=u){for(var d,h=new Map;d=i.exec(u);)h.set(d[1],(d[2]||d[3]||d[4]||"").trim());l.push(r,h)}(a.has(e)||u&&u.endsWith("/"))&&l.push(n)}}for(var h=u;u<s.length;)d(),h===u&&e("html",s,u),h=u;return f({lastIndex:0}),l}(l=l.replace(s,"")),d={nodes:[],tag:new Set(["*"]),class:new Set,attr:new Set};!function(e,a){for(var s,i=u(null,"root",o),c=0;c<e.length;c++)switch(e[c]){case t:var l=e[++c],f=o;e[c+1]===r&&(f=e[c+=2]),s=i.childNodes.length,i.childNodes.push(i=u(i,l,f)),a(i,s);break;case n:i=i.parentNode}}(f,function(e,t){return function(e,t,r){e.idx=t;var n=e.attributes;r.tag.add(e.tagName),e.classList.forEach(function(e){return r.class.add(e)}),n.has("id")&&r.attr.add("[id="+n.get("id")+"]"),n.has("type")&&r.attr.add("[type="+n.get("type")+"]"),r.nodes.push(e)}(e,t,d)});return d},h=/\s*\/\*[\s\S]*?\*\/\s*/gm,p=/\s*[>~+.#]\s*|\[[^\]]+\]|\s+/gm,v=1,m=2,x=3,g=4,y=5;function b(e){var t=e.split(/\s*,\s*/gm);return t.push(t.map(function(e){return function(e){for(var t=e.length;(e=e.replace(E,"")).length!=t;)t=e.length;return e.replace(/:?:[a-z-]+/gm,"")}(e).trim().replace(p,function(e,t){return e=e.trim(),0==t?e:"."==e||"#"==e?"`"+e:e.length<=1?"`":"`"+e.replace(/['"]/gm,"")}).split(/`+/gm)})),t}var E=/:[a-z-]+\([^()]*\)/;function k(e,t,r,n){for(var a="",s=1;e[t]==r?s++:e[t]==n&&s--,0!=s;)a+=e[t++];return a}function T(t){return function(t){var r,n={RULE_HEAD:/\s*([^{;]+?)\s*[{;]\s*/my,RULE_TAIL:/\s*([^}]*?)\s*\}/my,AT_TAIL:/\s*\}/my,RULE_FULL:/\s*([^{]*?)\{([^}]+?)\}/my},a=0,s=0,i=[];function c(e){for(var t in s=e.lastIndex,n)n[t].lastIndex=s}function o(){if(a>0&&null!=(r=n.AT_TAIL.exec(t)))return a--,i.push(m),void c(n.AT_TAIL);if(null!=(r=n.RULE_HEAD.exec(t))){var e=r[1];if(c(n.RULE_HEAD),"@"==e[0])switch(e.match(/@[a-z-]+/)[0]){case"@media":case"@supports":case"@document":a++,i.push(v,e);break;case"@import":case"@charset":case"@namespace":i.push(y,e+";");break;default:a++;var o=k(t,s,"{","}");c({lastIndex:s+o.length}),i.push(v,e,y,o)}else i.push(x,b(r[1])),r=n.RULE_TAIL.exec(t),i.push(g,r[1]),c(n.RULE_TAIL)}else s=t.length}for(var u=s;s<t.length;)o(),u===s&&e("css",t,s),u=s;return i}(t=t.replace(h,""))}function w(e){return e.replace(/@[a-z-]+[^{]+\{\s*\}/gm,"")}var I=/^([+-]?\d*)?n([+-]\d+)?$/;function A(e,t){return t==e.tagName||"*"==t}function S(e,t,r,n){n=n||"=";var a=e.attributes;if(a.has(t)){var s=a.get(t);switch(n){case"=":return null==r||r==s;case"*=":return-1!=s.indexOf(r);case"^=":return s.startsWith(r);case"$=":return s.endsWith(r);case"~=":return r==s||s.startsWith(r+" ")||s.endsWith(" "+r)||-1!=s.indexOf(" "+r+" ")}}return!1}function _(e,t){return e.classList.has(t)}function N(e,t){var r;if("odd"==t)r=e%2==1;else if("even"==t)r=e%2==0;else if(/^\d+$/.test(t))r=e==+t;else{var n=function(e){var t=I.exec(e);if(null!=t){var r=t[1],n=t[2];return[r=null==r||"+"==r?1:"-"==r?-1:+r,n=null==n?0:+n]}return[0,0]}(t);r=function(e,t,r){if(t<0&&e<=0)return!1;if(-1===e)return r<=t;if(0===e)return r===t;if(1===e)return t<0||r>=t;var n=t%e;return n<0&&(n+=e),e>1?r>=t&&r%e===n:(e*=-1,r<=t&&r%e===n)}(n[0],n[1],e)}return r}function L(e,t){return e.some(function(e){return function e(t,r){for(var n,a,s,i,c,o;r.idx>-1;){switch(t[r.idx]){case"_":n=t[--r.idx],o=A(r.node,n),r.idx--;break;case"#":a=t[--r.idx],o=S(r.node,"id",a,"="),r.idx--;break;case".":n=t[--r.idx],o=_(r.node,n),r.idx--;break;case"[":n=t[--r.idx],s=t[--r.idx],a=t[--r.idx],o=S(r.node,n,a,s),r.idx--;break;case":":n=t[--r.idx],a=t[--r.idx];var u=r.node,l=u.tagName;c=u.idx;var d=(i=u.parentNode)?i.childNodes.length:1,h=void 0;switch(n){case"not":o=!e(a,{node:r.node,idx:a.length-1});break;case"first-child":o=0==c;break;case"last-child":o=c==d-1;break;case"only-child":o=1==d;break;case"nth-child":o=N(c+1,a);break;case"nth-last-child":o=N(d-c,a);break;case"first-of-type":h=f(i,l),o=0==u._typeIdx;break;case"last-of-type":h=f(i,l),o=u._typeIdx==h.length-1;break;case"only-of-type":o=1==(h=f(i,l)).length;break;case"nth-of-type":h=f(i,l),o=N(u._typeIdx+1,a);break;case"nth-last-of-type":o=N((h=f(i,l)).length-u._typeIdx,a)}r.idx--;break;case" ":for(c=--r.idx,o=!1;!o&&null!=(i=r.node.parentNode);)r.idx=c,r.node=i,o=e(t,r);break;case">":r.idx--,null!=(i=r.node.parentNode)?(r.node=i,o=e(t,r)):o=!1;break;case"+":r.idx--,null!=(i=r.node.parentNode)&&r.node.idx>0?(r.node=i.childNodes[r.node.idx-1],o=e(t,r)):o=!1;break;case"~":if(r.idx--,o=!1,c=r.node.idx,null!=(i=r.node.parentNode)&&c>0)for(var p=0;p<c&&!o;p++)r.node=i.childNodes[p],o=e(t,r)}if(!o)break}return o}(t,{idx:t.length-1,node:e})})}var D=function(e,t){return L(e,Array.isArray(t)?t:function e(t){var r,n={IDENT:/([\w*-]+)/iy,ATTR:/([\w-]+)(?:(.?=)["']?([^\]]*?)["']?)?\]/iy,PSEUDO:/([\w-]+)(\()?/iy,MODE:/\s*[:.#\[]\s*/iy,COMB:/\s*[>~+]\s*|\s+/iy},a=0,s=[],i=-1;function c(e){for(var t in a=e.lastIndex,n)n[t].lastIndex=a}function o(){var a=!1;if(r=n.COMB.exec(t)){a=!0;var o=r[0].trim();""==o&&(o=" "),s.push(o),c(n.COMB),i=s.length-1}else if(r=n.MODE.exec(t)){a=!0;var u=r[0].trim();if(c(n.MODE),":"==u){if("("==(r=n.PSEUDO.exec(t))[2]){var l=k(t,n.PSEUDO.lastIndex,"(",")");n.PSEUDO.lastIndex+=l.length+1,r[2]="not"==r[1]?e(l):l}s.splice(i+1,0,r[2],r[1],u),c(n.PSEUDO)}else"["==u?(r=n.ATTR.exec(t),s.splice(i+1,0,r[3],r[2],r[1],u),c(n.ATTR)):(r=n.IDENT.exec(t),s.push(r[1],u),c(n.IDENT))}else(r=n.IDENT.exec(t))&&(a=!0,s.push(r[1],"_"),c(n.IDENT));return a}for(;a<t.length;)o();return s}(t))};function O(e,t,r,n,a){a=a||"";for(var s=t.length-1;s>-1;s--){var i=t[s];r.has(i[2])||!0!==n(a+i[2])||(c=e,o=i[0],u=i[1],l="",e=c.slice(0,o)+l+c.slice(o+u))}var c,o,u,l;return e}function U(e){for(var t,r=/(--[\w-]+)\s*:\s*([^;]+)\s*/gm,n=/var\(([\w-]+)\)/gm,a={};n.test(e);){for(;t=r.exec(e);)a[t[1]]=t[2];e=e.replace(n,function(e,t){return n.test(a[t])?e:a[t]})}return e}function R(e,t,r,n){return e=function(e,t){for(var r,n=[],a=new Set,s=/@font-face[\s\S]+?font-family:\s*['"]?([\w- ]+)['"]?[^}]+\}/gm;r=s.exec(e);)n.push([r.index,r[0].length,r[1]]);for(var i=U(e),c=/font-family:([^;!}]+)/gm;r=c.exec(i);)n.some(function(e){return r.index>e[0]&&r.index<e[0]+e[1]})||r[1].trim().split(",").forEach(function(e){a.add(e.trim().replace(/['"]/gm,""))});for(var o=/font:([^;!}]+)/gm;r=o.exec(i);)r[1].trim().split(",").forEach(function(e){a.add(e.trim().match(/\s*['"]?([\w- ]+)['"]?$/)[1])});return O(e,n,a,t,"@font-face ")}(e=function(e,t){for(var r,n=[],a=new Set,s=/@(?:-\w+-)?keyframes\s+([\w-]+)\s*\{/gm;r=s.exec(e);){var i=k(e,s.lastIndex,"{","}");n.push([r.index,r[0].length+i.length+1,r[1]])}for(var c=U(e),o=/animation(?:-name)?:([^;!}]+)/gm;r=o.exec(c);)r[1].trim().split(",").forEach(function(e){var t=(e=e.trim()).match(/^\S+/)[0];/^-?[\d.]+m?s/.test(t)&&(t=e.match(/\S+$/)[0]),a.add(t)});return O(e,n,a,t,"@keyframes ")}(e,t),t)}var M=/\[([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/i,W=/:(?:first|last|nth|only|not)\b/;var z=function(e){return!0};return function(e){for(var t=d(e.html,!e.keepText),r=e.shouldDrop||z,n=T(e.css),a={},s=0;s<n.length;s++)if(n[s]===x){var i=n[s+1],c=i[i.length-1];s++;for(var o=0;o<c.length;o++){var u=c[o];e:for(var l=0;l<u.length;l++){var f=u[l],h=!1,p=void 0;if(""!=f){if(f in a)h=a[f];else switch(f[0]){case"#":p=f.substr(1),a[f]=h=t.attr.has("[id="+p+"]");break;case".":p=f.substr(1),a[f]=h=t.class.has(p);break;case"[":if(f.startsWith("[type="))a[f]=h=t.attr.has(f);else{var b=f.match(M);a[f]=h=t.nodes.some(function(e){return S(e,b[1],b[3],b[2])})}break;default:a[f]=h=t.tag.has(f)}if(!h){!0===r(i[o])?i[o]=null:a[i[o]]=!0;break e}}}}}for(var E=0;E<n.length;E++)n[E]===x&&(n[++E].length,n[E]=n[E].filter(function(e){if("string"==typeof e){if(e in a)return a[e];var n=(s=e).replace(/:?:[a-z-]+/gm,function(e){return s.startsWith("::")||!W.test(e)?"":e}).replace(/:[a-z-]+\(\)/gm,"");return""==n||(n in a?a[n]:a[n]=D(t.nodes,n)||!0!==r(e))}var s;return!1}));var k=new Set,I=function(e,t){for(var r="",n=0,a=0;a<e.length;a++)switch(e[a]){case x:var s=e[++a];(n=s.length)>0&&(s.forEach(function(e){return t.add(e)}),r+=s.join());break;case g:n>0&&(r+="{"+e[++a]+"}");break;case v:r+=e[++a]+"{";break;case m:r+="}";break;case y:r+=e[++a]}return w(r)}(n,k);return{css:w(I=R(I,r)),sels:k}}});
