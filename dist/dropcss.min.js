/*! https://github.com/leeoniya/dropcss (v1.0.15) */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).dropcss=r()}(this,(function(){"use strict";function e(e,r,t){throw new Error(e+' parser stopped here: "'+r.substring(t,t+100)+'"')}var r=1,t=2,n=3,a=new Set("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),s=/<!doctype[^>]*>|<!--[\s\S]*?-->|<script[^>]*>[\s\S]*?<\/script>|<style[^>]*>[\s\S]*?<\/style>|<link[^>]*>|<meta[^>]*>/gim,i={NAME:/\s*<([\w-]+)\s*/imy,ATTR:/\s*([\w-]+)(?:="([^"]*)"|='([^']*)'|=([\w-]+))?\s*/imy,TAIL:/\s*(\/?>)\s*/imy,TEXT:/\s*[^<]*/my,CLOSE:/\s*<\/[\w-]+>\s*/imy};var c=new Set;function o(e,r,t){return{tagName:r,attributes:t,classList:null!=t&&t.has("class")?new Set(t.get("class").split(/\s+/g)):c,parentNode:e,childNodes:[]}}var u=[];function f(e,r){if(null!=e){var t=e._ofTypes=e._ofTypes||{};if(!(r in t)){var n=0;t[r]=e.childNodes.filter((function(e){if(e.tagName==r)return e._typeIdx=n++,!0}))}return t[r]}return u}var l=function(u){var f=function(s){var c,o,u=0,f=[];function l(e){for(var r in u=e.lastIndex,i)i[r].lastIndex=u}function d(){if(null!=(c=i.CLOSE.exec(s)))return l(i.CLOSE),void f.push(n);if(null!=(c=i.NAME.exec(s))){l(i.NAME);var e,u=c[1];for(f.push(r,u);o=i.ATTR.exec(s);)l(i.ATTR),(e=e||new Map).set(o[1],(o[2]||o[3]||o[4]||"").trim());return e&&f.push(t,e),o=i.TAIL.exec(s),(a.has(u)||"/>"==o[1])&&f.push(n),void l(i.TAIL)}null!=(c=i.TEXT.exec(s))&&l(i.TEXT)}for(var h=u;u<s.length;)d(),h===u&&e("html",s,u),h=u;return l({lastIndex:0}),f}(u=u.replace(s,"")),l={nodes:[],tag:new Set(["*"]),class:new Set,attr:new Set};!function(e,a){for(var s,i=o(null,"root",c),u=0;u<e.length;u++){switch(e[u]){case r:var f=e[++u],l=c;e[u+1]===t&&(l=e[u+=2]),s=i.childNodes.length,i.childNodes.push(i=o(i,f,l)),a(i,s);break;case n:i=i.parentNode}}}(f,(function(e,r){return function(e,r,t){e.idx=r;var n=e.attributes;t.tag.add(e.tagName),e.classList.forEach((function(e){return t.class.add(e)})),n.has("id")&&t.attr.add("[id="+n.get("id")+"]"),n.has("type")&&t.attr.add("[type="+n.get("type")+"]"),t.nodes.push(e)}(e,r,l)}));return l},d=/\s*\/\*[\s\S]*?\*\/\s*/gm,h=/\s*[>~+.#]\s*|\[[^\]]+\]|\s+/gm,p=1,v=2,x=3,g=4,m=5;function y(e){var r=e.split(/\s*,\s*/gm);return r.push(r.map((function(e){return function(e){for(var r=e.length;(e=e.replace(b,"")).length!=r;)r=e.length;return e.replace(/:?:[a-z-]+/gm,"")}(e).trim().replace(h,(function(e,r){return e=e.trim(),0==r?e:"."==e||"#"==e?"`"+e:e.length<=1?"`":"`"+e.replace(/['"]/gm,"")})).split(/`+/gm)}))),r}var b=/:[a-z-]+\([^()]*\)/;function E(e,r,t,n){for(var a="",s=1;e[r]==t?s++:e[r]==n&&s--,0!=s;)a+=e[r++];return a}function T(r){return function(r){var t,n={RULE_HEAD:/\s*([^{;]+?)\s*[{;]\s*/my,RULE_TAIL:/\s*([^}]*?)\s*\}/my,AT_TAIL:/\s*\}/my,RULE_FULL:/\s*([^{]*?)\{([^}]+?)\}/my},a=0,s=0,i=[];function c(e){for(var r in s=e.lastIndex,n)n[r].lastIndex=s}function o(){if(a>0&&null!=(t=n.AT_TAIL.exec(r)))return a--,i.push(v),void c(n.AT_TAIL);if(null!=(t=n.RULE_HEAD.exec(r))){var e=t[1];if(c(n.RULE_HEAD),"@"==e[0])switch(e.match(/@[a-z-]+/)[0]){case"@media":case"@supports":case"@document":a++,i.push(p,e);break;case"@import":case"@charset":case"@namespace":i.push(m,e+";");break;default:a++;var o=E(r,s,"{","}");c({lastIndex:s+o.length}),i.push(p,e,m,o)}else i.push(x,y(t[1])),t=n.RULE_TAIL.exec(r),i.push(g,t[1]),c(n.RULE_TAIL)}else s=r.length}for(var u=s;s<r.length;)o(),u===s&&e("css",r,s),u=s;return i}(r=r.replace(d,""))}function k(e){return e.replace(/@[a-z-]+[^{]+\{\s*\}/gm,"")}var w=/^([+-]?\d*)?n([+-]\d+)?$/;function I(e,r){return r==e.tagName||"*"==r}function N(e,r,t,n){n=n||"=";var a=e.attributes;if(a.has(r)){var s=a.get(r);switch(n){case"=":return null==t||t==s;case"*=":return-1!=s.indexOf(t);case"^=":return s.startsWith(t);case"$=":return s.endsWith(t);case"~=":return t==s||s.startsWith(t+" ")||s.endsWith(" "+t)||-1!=s.indexOf(" "+t+" ")}}return!1}function A(e,r){return e.classList.has(r)}function L(e,r){var t;if("odd"==r)t=e%2==1;else if("even"==r)t=e%2==0;else if(/^\d+$/.test(r))t=e==+r;else{var n=function(e){var r=w.exec(e);if(null!=r){var t=r[1],n=r[2];return[t=null==t||"+"==t?1:"-"==t?-1:+t,n=null==n?0:+n]}return[0,0]}(r);t=function(e,r,t){if(r<0&&e<=0)return!1;if(-1===e)return t<=r;if(0===e)return t===r;if(1===e)return r<0||t>=r;var n=r%e;return n<0&&(n+=e),e>1?t>=r&&t%e===n:(e*=-1,t<=r&&t%e===n)}(n[0],n[1],e)}return t}function S(e,r){return e.some((function(e){return function e(r,t){for(var n,a,s,i,c,o;t.idx>-1;){switch(r[t.idx]){case"_":n=r[--t.idx],o=I(t.node,n),t.idx--;break;case"#":a=r[--t.idx],o=N(t.node,"id",a,"="),t.idx--;break;case".":n=r[--t.idx],o=A(t.node,n),t.idx--;break;case"[":n=r[--t.idx],s=r[--t.idx],a=r[--t.idx],o=N(t.node,n,a,s),t.idx--;break;case":":n=r[--t.idx],a=r[--t.idx];var u=t.node,l=u.tagName;c=u.idx;var d=(i=u.parentNode)?i.childNodes.length:1,h=void 0;switch(n){case"not":o=!e(a,{node:t.node,idx:a.length-1});break;case"first-child":o=0==c;break;case"last-child":o=c==d-1;break;case"only-child":o=1==d;break;case"nth-child":o=L(c+1,a);break;case"nth-last-child":o=L(d-c,a);break;case"first-of-type":h=f(i,l),o=0==u._typeIdx;break;case"last-of-type":h=f(i,l),o=u._typeIdx==h.length-1;break;case"only-of-type":o=1==(h=f(i,l)).length;break;case"nth-of-type":h=f(i,l),o=L(u._typeIdx+1,a);break;case"nth-last-of-type":o=L((h=f(i,l)).length-u._typeIdx,a)}t.idx--;break;case" ":for(c=--t.idx,o=!1;!o&&null!=(i=t.node.parentNode);)t.idx=c,t.node=i,o=e(r,t);break;case">":t.idx--,null!=(i=t.node.parentNode)?(t.node=i,o=e(r,t)):o=!1;break;case"+":t.idx--,null!=(i=t.node.parentNode)&&t.node.idx>0?(t.node=i.childNodes[t.node.idx-1],o=e(r,t)):o=!1;break;case"~":if(t.idx--,o=!1,c=t.node.idx,null!=(i=t.node.parentNode)&&c>0)for(var p=0;p<c&&!o;p++)t.node=i.childNodes[p],o=e(r,t)}if(!o)break}return o}(r,{idx:r.length-1,node:e})}))}var _=function(e,r){return S(e,Array.isArray(r)?r:function e(r){var t,n={IDENT:/([\w*-]+)/iy,ATTR:/([\w-]+)(?:(.?=)["']?([^\]]*?)["']?)?\]/iy,PSEUDO:/([\w-]+)(\()?/iy,MODE:/\s*[:.#\[]\s*/iy,COMB:/\s*[>~+]\s*|\s+/iy},a=0,s=[],i=-1;function c(e){for(var r in a=e.lastIndex,n)n[r].lastIndex=a}function o(){var a=!1;if(t=n.COMB.exec(r)){a=!0;var o=t[0].trim();""==o&&(o=" "),s.push(o),c(n.COMB),i=s.length-1}else if(t=n.MODE.exec(r)){a=!0;var u=t[0].trim();if(c(n.MODE),":"==u){if("("==(t=n.PSEUDO.exec(r))[2]){var f=E(r,n.PSEUDO.lastIndex,"(",")");n.PSEUDO.lastIndex+=f.length+1,t[2]="not"==t[1]?e(f):f}s.splice(i+1,0,t[2],t[1],u),c(n.PSEUDO)}else"["==u?(t=n.ATTR.exec(r),s.splice(i+1,0,t[3],t[2],t[1],u),c(n.ATTR)):(t=n.IDENT.exec(r),s.push(t[1],u),c(n.IDENT))}else(t=n.IDENT.exec(r))&&(a=!0,s.push(t[1],"_"),c(n.IDENT));return a}for(;a<r.length;)o();return s}(r))};function D(e,r,t,n,a){a=a||"";for(var s=r.length-1;s>-1;s--){var i=r[s];t.has(i[2])||!0!==n(a+i[2])||(c=e,o=i[0],u=i[1],f="",e=c.slice(0,o)+f+c.slice(o+u))}var c,o,u,f;return e}var O=/([{};])\s*(--[\w-]+)\s*:\s*([^;}]+);?\s*/gm,R=/var\(([\w-]+)\)/gm,U=/\s*,\s*/gm;function M(e){return e.trim().replace(/'|"/gm,"").split(U)}function z(e,r,t,n){var a=function(e){for(var r,t={};R.test(e);){for(;r=O.exec(e);)t[r[2]]=r[3];e=e.replace(R,(function(e,r){return R.test(t[r])?e:t[r]}))}return e}(e).replace(O,(function(e,r){return r}));return(e=function(e,r){var t=e;do{t=(e=t).replace(O,(function(r,t,n){return-1!=e.indexOf("var("+n+")")?r:t}))}while(t!=e);return t}(e=function(e,r,t){for(var n,a="@font-face[^}]+\\}+",s=RegExp(a,"gm"),i=[];n=s.exec(e);)i.push([n.index,n[0].length]);for(var c,o="font-family:([^;!}]+)",u=RegExp(o),f=0;n=s.exec(r);)c=u.exec(n[0]),i[f++].push(M(c[1])[0]);for(var l=new Set,d=RegExp(a+"|"+o,"gm");n=d.exec(r);)"@"!==n[0][0]&&M(n[1]).forEach((function(e){return l.add(e)}));for(var h,p=/font:([^;!}]+)/gm,v=/\s*(?:['"][\w- ]+['"]|[\w-]+)\s*(?:,|$)/gm;n=p.exec(r);){for(h="";c=v.exec(n[1]);)h+=c[0];M(h).forEach((function(e){return l.add(e)}))}return D(e,i,l,t,"@font-face ")}(e=function(e,r,t){for(var n,a=[],s=/@(?:-\w+-)?keyframes\s+([\w-]+)\s*\{/gm;n=s.exec(e);){var i=E(e,s.lastIndex,"{","}");a.push([n.index,n[0].length+i.length+1,n[1]])}for(var c=new Set,o=/animation(?:-name)?:([^;!}]+)/gm;n=o.exec(r);)n[1].trim().split(U).forEach((function(e){var r=e.match(/^\S+/)[0];/^-?[\d.]+m?s/.test(r)&&(r=e.match(/\S+$/)[0]),c.add(r)}));return D(e,a,c,t,"@keyframes ")}(e,a,r),a,r))).replace(/[^{}]+\{\s*\}/gm,"")}var C=/\[([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/i,W=/:(?:first|last|nth|only|not)\b/;var P=function(e){return!0};return function(e){for(var r=l(e.html,!e.keepText),t=e.shouldDrop||P,n=T(e.css),a={},s=0;s<n.length;s++){if(n[s]===x){var i=n[s+1],c=i[i.length-1];s++;for(var o=0;o<c.length;o++){var u=c[o];e:for(var f=0;f<u.length;f++){var d=u[f],h=!1,y=void 0;if(""!=d){if(d in a)h=a[d];else switch(d[0]){case"#":y=d.substr(1),a[d]=h=r.attr.has("[id="+y+"]");break;case".":y=d.substr(1),a[d]=h=r.class.has(y);break;case"[":if(d.startsWith("[type="))a[d]=h=r.attr.has(d);else{var b=d.match(C);a[d]=h=r.nodes.some((function(e){return N(e,b[1],b[3],b[2])}))}break;default:a[d]=h=r.tag.has(d)}if(!h){!0===t(i[o])?i[o]=null:a[i[o]]=!0;break e}}}}}}for(var E=0;E<n.length;E++){if(n[E]===x){n[++E].length;n[E]=n[E].filter((function(e){if("string"==typeof e){if(e in a)return a[e];var n=e.replace(/:?:[a-z-]+/gm,(function(e){return e.startsWith("::")||!W.test(e)?"":e})).replace(/:[a-z-]+\(\)/gm,"");return""==n||(n in a?a[n]:a[n]=_(r.nodes,n)||!0!==t(e))}return!1}))}}var w=new Set,I=function(e,r){for(var t="",n=0,a=0;a<e.length;a++){switch(e[a]){case x:var s=e[++a];(n=s.length)>0&&(s.forEach((function(e){return r.add(e)})),t+=s.join());break;case g:n>0&&(t+="{"+e[++a]+"}");break;case p:t+=e[++a]+"{";break;case v:t+="}";break;case m:t+=e[++a]}}return k(t)}(n,w);return{css:k(I=z(I,t)),sels:w}}}));
