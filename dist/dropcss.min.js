/*! https://github.com/leeoniya/dropcss (v0.5.0-dev) */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).dropcss=r()}(this,function(){"use strict";var e=1,r=2,t=3,n=4;var a=new Set;function s(e,r,t){var n="#"==r;return{tagName:r,attributes:t,classList:!n&&null!=t&&t.has("class")?new Set(t.get("class").split(/\s+/g)):a,parentNode:e,childNodes:n?null:[]}}var i=/\s*\/\*[\s\S]*?\*\/\s*/gm,c=/\s*[>~+]\s*|\s+/g,u=1,l=2,d=3,o=4,f=5;function h(e){var r,t={RULE_HEAD:/\s*([^{;]+?)\s*[{;]\s*/my,RULE_TAIL:/\s*([^}]+?)\s*\}/my,AT_TAIL:/\s*\}/my,RULE_FULL:/\s*([^{]+?)\{([^}]+?)\}/my},n=0,a=0,s=[];function i(e){for(var r in a=e.lastIndex,t)t[r].lastIndex=a}function h(){if(n>0&&null!=(r=t.AT_TAIL.exec(e)))return n--,s.push(l),void i(t.AT_TAIL);if(null!=(r=t.RULE_HEAD.exec(e))){var h=r[1];if(i(t.RULE_HEAD),"@"==h[0])switch(h.match(/@[a-z-]+/)[0]){case"@media":case"@supports":case"@document":n++,s.push(u,h);break;case"@import":case"@charset":case"@namespace":s.push(f,h+";");break;default:n++;var p=function(){for(var r="",t=1;"{"==e[a]?t++:"}"==e[a]&&t--,0!=t;)r+=e[a++];return i({lastIndex:a}),r}();s.push(u,h,f,p)}else s.push(d,(v=r[1],(x=v.split(/\s*,\s*/gm)).push(x.map(function(e){return function(e){return e.replace(/:?:[a-z-]+(?:\([^()]+\))?/gm,"")}(e).trim().replace(/(\.|#|\[)/gm," $1").replace(/\]/gm,"] ").trim().split(c)})),x)),r=t.RULE_TAIL.exec(e),s.push(o,r[1]),i(t.RULE_TAIL)}else a=e.length;var v,x}for(;a<e.length;)h();return s}var p={parse:function(e){return h(e=e.replace(i,""))},generate:function(e){for(var r="",t=0,n=0;n<e.length;n++)switch(e[n]){case d:var a=e[++n];(t=a.length)>0&&(r+=a.join());break;case o:t>0&&(r+="{"+e[++n]+"}");break;case u:r+=e[++n]+"{";break;case l:r+="}";break;case f:r+=e[++n]}return r.replace(/@[a-z-]+\s+[^{]+\{\s*\}/gm,"")},SELECTORS:d};var v={type:function(e,r){return r==e.tagName||"*"==r},class:function(e,r){return e.classList.has(r)},attr:function(e,r,t,n){n=n||"=";var a=e.attributes;if(a.has(r)){var s=a.get(r);switch(n){case"=":return null==t||t==s;case"*=":return-1!=s.indexOf(t);case"^=":return s.startsWith(t);case"$=":return s.endsWith(t)}}return!1},nthChild:function(e,r,t){if(r<0&&e<=0)return!1;if(-1===e)return t<=r;if(0===e)return t===r;if(1===e)return r<0||t>=r;var n=r%e;return n<0&&(n+=e),e>1?t>=r&&t%e===n:(e*=-1,t<=r&&t%e===n)}};function x(e){var r,t={IDENT:/([\w*-]+)/iy,ATTR:/([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/iy,PSEUDO:/([\w-]+)(?:\(([^)]*)\))?/iy,MODE:/\s*:?[:.#\[]\s*/iy,COMB:/\s*[>~+]\s*|\s+/iy},n=0,a=[],s=-1;function i(e){for(var r in n=e.lastIndex,t)t[r].lastIndex=n}function c(){var c=!1;if(r=t.COMB.exec(e)){c=!0;var u=r[0].trim();""==u&&(u=" "),a.push(u),i(t.COMB),s=n}else if(r=t.MODE.exec(e)){c=!0;var l=r[0].trim();""==l&&(l=" "),i(t.MODE),":"==l?(r=t.PSEUDO.exec(e),a.splice(s+1,0,null!=r[2]&&"not"==r[1]?x(r[2]):r[2],r[1],l),i(t.PSEUDO)):"["==l?(r=t.ATTR.exec(e),a.splice(s+1,0,r[3],r[2],r[1],l),i(t.ATTR)):(r=t.IDENT.exec(e),a.push(r[1],l),i(t.IDENT))}else(r=t.IDENT.exec(e))&&(c=!0,a.push(r[1],"_"),i(t.IDENT));return c}for(;n<e.length;)c();return a}function m(e,r){return e.some(function(e){return function e(r,t){var n,a,s,i,c,u;for(;t.idx>-1;){switch(r[t.idx]){case"_":n=r[--t.idx],u=v.type(t.node,n),t.idx--;break;case"#":a=r[--t.idx],u=v.attr(t.node,"id",a,"="),t.idx--;break;case".":n=r[--t.idx],u=v.class(t.node,n),t.idx--;break;case"[":n=r[--t.idx],s=r[--t.idx],a=r[--t.idx],u=v.attr(t.node,n,a,s),t.idx--;break;case":":n=r[--t.idx],a=r[--t.idx];var l=t.node;c=l.idx;var d=(i=l.parentNode)?i.childNodes.length:1;switch(n){case"not":u=!e(a,{node:t.node,idx:a.length-1});break;case"empty":u=0==l.childNodes.length;break;case"first-child":u=0==c;break;case"last-child":u=c==d-1;break;case"only-child":u=1==d;break;case"nth-child":u=T(c+1,a);break;case"nth-last-child":u=T(d-c,a)}t.idx--;break;case" ":for(c=--t.idx,u=!1;!u&&null!=(i=t.node.parentNode);)t.idx=c,t.node=i,u=e(r,t);break;case">":t.idx--,null!=(i=t.node.parentNode)?(t.node=i,u=e(r,t)):u=!1;break;case"+":t.idx--,null!=(i=t.node.parentNode)&&t.node.idx>0?(t.node=i.childNodes[t.node.idx-1],u=e(r,t)):u=!1;break;case"~":if(t.idx--,u=!1,c=t.node.idx,null!=(i=t.node.parentNode)&&c>0)for(var o=0;o<c&&!u;o++)t.node=i.childNodes[o],u=e(r,t)}if(!u)break}return u}(r,{idx:r.length-1,node:e})})}var g=/^([+-]?\d*)?n([+-]\d+)?$/;function b(e){var r=g.exec(val);if(null!=r){var t=r[1],n=r[2];return[t=null==t||"+"==t?1:"-"==t?-1:+t,n=null==n?0:+n]}return[0,0]}function T(e,r){if("odd"==r)res=e%2==1;else if("even"==r)res=e%2==0;else if(/^\d+$/.test(r))res=e==+r;else{var t=b();res=v.nthChild(t[0],t[1],e)}return res}var E=function(i,c){var u=function(a,s){var i,c={TAG_HEAD:/\s*<([a-z0-9_-]+)(?:\s+([^>]*))?>\s*/my,TAG_TEXT:/\s*[^<]*/my,TAG_CLOSE:/\s*<\/[a-z0-9_-]+>\s*/my},u=/([\w-]+)(?:="([^"]*)"|='([^']*)'|=(\S+))?/gm,l=0,d=[];function o(e){for(var r in l=e.lastIndex,c)c[r].lastIndex=l}var f={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function h(){if(null!=(i=c.TAG_CLOSE.exec(a)))return o(c.TAG_CLOSE),void d.push(n);if(null==(i=c.TAG_HEAD.exec(a)))null!=(i=c.TAG_TEXT.exec(a))&&(o(c.TAG_TEXT),s&&d.push(t,i[0]));else{o(c.TAG_HEAD);var l=i[1];d.push(e,l);var h=i[2];if(null!=h){for(var p,v=new Map;p=u.exec(h);)v.set(p[1],(p[2]||p[3]||p[4]||"").trim());d.push(r,v)}l in f&&d.push(n)}}for(;l<a.length;)h();return d}(i=i.replace(/<!doctype[^>]*>|<!--[\s\S]*?-->|<script[^>]*>[\s\S]*?<\/script>|<style[^>]*>[\s\S]*?<\/style>|<link[^>]*>|<meta[^>]*>/gim,""),!c),l={nodes:[],tag:new Set(["*"]),class:new Set,attr:new Set};!function(i,c){for(var u,l=s(null,"root",a),d=0;d<i.length;d++)switch(i[d]){case e:var o=i[++d],f=a;i[d+1]===r&&(f=i[d+=2]),u=l.childNodes.length,l.childNodes.push(l=s(l,o,f)),c(l,u);break;case n:l=l.parentNode;break;case t:var h=s(l,"#",a);l.childNodes.push(h),c(h,l.childNodes.length-1)}}(u,function(e,r){return function(e,r,t){e.idx=r;var n=e.attributes;t.tag.add(e.tagName),e.classList.forEach(function(e){return t.class.add(e)}),n.has("id")&&t.attr.add("[id="+n.get("id")+"]"),n.has("type")&&t.attr.add("[type="+n.get("type")+"]"),t.nodes.push(e)}(e,r,l)});return l},k=p.parse,y=p.generate,A=p.SELECTORS,N=function(e,r){return m(e,Array.isArray(r)?r:x(r))},L=/\[([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/i,_=/:(?:first|last|nth|only|not|empty)\b/;var S=function(e){return!1};return function(e){for(var r=E(e.html,!e.keepText),t=e.shouldKeep||S,n=k(e.css),a={},s=0;s<n.length;s++)if(n[s]===A){var i=n[s+1],c=i[i.length-1];s++;for(var u=0;u<c.length;u++){var l=c[u];e:for(var d=0;d<l.length;d++){var o=l[d],f=!1,h=void 0;if(""!=o){if(o in a)f=a[o];else switch(o[0]){case"#":h=o.substr(1),a[o]=f=r.attr.has("[id="+h+"]");break;case".":h=o.substr(1),a[o]=f=r.class.has(h);break;case"[":if(o.startsWith("[type="))a[o]=f=r.attr.has(o);else{var p=o.match(L);a[o]=f=r.nodes.some(function(e){return v.attr(e,p[1],p[3],p[2])})}break;default:a[o]=f=r.tag.has(o)}if(!f){!0!==t(i[u])?i[u]=null:a[i[u]]=!0;break e}}}}}for(var x=0;x<n.length;x++)n[x]===A&&(n[++x].length,n[x]=n[x].filter(function(e){if("string"==typeof e){if(e in a)return a[e];var n=(s=e).replace(/:?:[a-z-]+/gm,function(e){return s.startsWith("::")||!_.test(e)?"":e}).replace(/:[a-z-]+\(\)/gm,"");return""==n||(n in a?a[n]:a[n]=N(r.nodes,n)||!0===t(e))}var s;return!1}));return{css:y(n)}}});
