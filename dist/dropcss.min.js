/*! https://github.com/leeoniya/dropcss (v0.5.0) */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).dropcss=r()}(this,function(){"use strict";var e=1,r=2,t=3,n=4,a=new Set("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),s=/<!doctype[^>]*>|<!--[\s\S]*?-->|<script[^>]*>[\s\S]*?<\/script>|<style[^>]*>[\s\S]*?<\/style>|<link[^>]*>|<meta[^>]*>/gim,i=/([\w-]+)(?:="([^"]*)"|='([^']*)'|=(\S+))?/gm,c={TAG_HEAD:/\s*<([a-z0-9_-]+)(?:\s+([^>]*))?>\s*/my,TAG_TEXT:/\s*[^<]*/my,TAG_CLOSE:/\s*<\/[a-z0-9_-]+>\s*/my};var l=new Set;function u(e,r,t){var n="#"==r;return{tagName:r,attributes:t,classList:!n&&null!=t&&t.has("class")?new Set(t.get("class").split(/\s+/g)):l,parentNode:e,childNodes:n?null:[]}}var o=function(o,d){var f=function(s,l){var u,o=0,d=[];function f(e){for(var r in o=e.lastIndex,c)c[r].lastIndex=o}function h(){if(null!=(u=c.TAG_CLOSE.exec(s)))return f(c.TAG_CLOSE),void d.push(n);if(null==(u=c.TAG_HEAD.exec(s)))null!=(u=c.TAG_TEXT.exec(s))&&(f(c.TAG_TEXT),l&&d.push(t,u[0]));else{f(c.TAG_HEAD);var o=u[1];d.push(e,o);var h=u[2];if(null!=h){for(var p,v=new Map;p=i.exec(h);)v.set(p[1],(p[2]||p[3]||p[4]||"").trim());d.push(r,v)}a.has(o)&&d.push(n)}}for(;o<s.length;)h();return f({lastIndex:0}),d}(o=o.replace(s,""),!d),h={nodes:[],tag:new Set(["*"]),class:new Set,attr:new Set};!function(a,s){for(var i,c=u(null,"root",l),o=0;o<a.length;o++)switch(a[o]){case e:var d=a[++o],f=l;a[o+1]===r&&(f=a[o+=2]),i=c.childNodes.length,c.childNodes.push(c=u(c,d,f)),s(c,i);break;case n:c=c.parentNode;break;case t:var h=u(c,"#",l);c.childNodes.push(h),s(h,c.childNodes.length-1)}}(f,function(e,r){return function(e,r,t){e.idx=r;var n=e.attributes;t.tag.add(e.tagName),e.classList.forEach(function(e){return t.class.add(e)}),n.has("id")&&t.attr.add("[id="+n.get("id")+"]"),n.has("type")&&t.attr.add("[type="+n.get("type")+"]"),t.nodes.push(e)}(e,r,h)});return h},d=/\s*\/\*[\s\S]*?\*\/\s*/gm,f=/\s*[>~+]\s*|\s+/g,h=1,p=2,v=3,x=4,m=5;function g(e,r){for(var t="",n=1;"{"==e[r]?n++:"}"==e[r]&&n--,0!=n;)t+=e[r++];return t}function b(e){var r,t={RULE_HEAD:/\s*([^{;]+?)\s*[{;]\s*/my,RULE_TAIL:/\s*([^}]*?)\s*\}/my,AT_TAIL:/\s*\}/my,RULE_FULL:/\s*([^{]*?)\{([^}]+?)\}/my},n=0,a=0,s=[];function i(e){for(var r in a=e.lastIndex,t)t[r].lastIndex=a}function c(){if(n>0&&null!=(r=t.AT_TAIL.exec(e)))return n--,s.push(p),void i(t.AT_TAIL);if(null!=(r=t.RULE_HEAD.exec(e))){var c=r[1];if(i(t.RULE_HEAD),"@"==c[0])switch(c.match(/@[a-z-]+/)[0]){case"@media":case"@supports":case"@document":n++,s.push(h,c);break;case"@import":case"@charset":case"@namespace":s.push(m,c+";");break;default:n++;var l=g(e,a);i({lastIndex:a+l.length}),s.push(h,c,m,l)}else s.push(v,(u=r[1],(o=u.split(/\s*,\s*/gm)).push(o.map(function(e){return function(e){return e.replace(/:?:[a-z-]+(?:\([^()]+\))?/gm,"")}(e).trim().replace(/(\.|#|\[)/gm," $1").replace(/\]/gm,"] ").trim().split(f)})),o)),r=t.RULE_TAIL.exec(e),s.push(x,r[1]),i(t.RULE_TAIL)}else a=e.length;var u,o}for(;a<e.length;)c();return s}function T(e,r){return r==e.tagName||"*"==r}function k(e,r,t,n){n=n||"=";var a=e.attributes;if(a.has(r)){var s=a.get(r);switch(n){case"=":return null==t||t==s;case"*=":return-1!=s.indexOf(t);case"^=":return s.startsWith(t);case"$=":return s.endsWith(t)}}return!1}function E(e,r){return e.classList.has(r)}function y(e,r){return e.some(function(e){return function e(r,t){var n,a,s,i,c,l;for(;t.idx>-1;){switch(r[t.idx]){case"_":n=r[--t.idx],l=T(t.node,n),t.idx--;break;case"#":a=r[--t.idx],l=k(t.node,"id",a,"="),t.idx--;break;case".":n=r[--t.idx],l=E(t.node,n),t.idx--;break;case"[":n=r[--t.idx],s=r[--t.idx],a=r[--t.idx],l=k(t.node,n,a,s),t.idx--;break;case":":n=r[--t.idx],a=r[--t.idx];var u=t.node;c=u.idx;var o=(i=u.parentNode)?i.childNodes.length:1;switch(n){case"not":l=!e(a,{node:t.node,idx:a.length-1});break;case"empty":l="#"!=u.tagName&&0==u.childNodes.length;break;case"first-child":l=0==c;break;case"last-child":l=c==o-1;break;case"only-child":l=1==o;break;case"nth-child":l=N(c+1,a);break;case"nth-last-child":l=N(o-c,a)}t.idx--;break;case" ":for(c=--t.idx,l=!1;!l&&null!=(i=t.node.parentNode);)t.idx=c,t.node=i,l=e(r,t);break;case">":t.idx--,null!=(i=t.node.parentNode)?(t.node=i,l=e(r,t)):l=!1;break;case"+":t.idx--,null!=(i=t.node.parentNode)&&t.node.idx>0?(t.node=i.childNodes[t.node.idx-1],l=e(r,t)):l=!1;break;case"~":if(t.idx--,l=!1,c=t.node.idx,null!=(i=t.node.parentNode)&&c>0)for(var d=0;d<c&&!l;d++)t.node=i.childNodes[d],l=e(r,t)}if(!l)break}return l}(r,{idx:r.length-1,node:e})})}var A=/^([+-]?\d*)?n([+-]\d+)?$/;function N(e,r){if("odd"==r)res=e%2==1;else if("even"==r)res=e%2==0;else if(/^\d+$/.test(r))res=e==+r;else{var t=function(e){var r=A.exec(e);if(null!=r){var t=r[1],n=r[2];return[t=null==t||"+"==t?1:"-"==t?-1:+t,n=null==n?0:+n]}return[0,0]}(r);res=function(e,r,t){if(r<0&&e<=0)return!1;if(-1===e)return t<=r;if(0===e)return t===r;if(1===e)return r<0||t>=r;var n=r%e;return n<0&&(n+=e),e>1?t>=r&&t%e===n:(e*=-1,t<=r&&t%e===n)}(t[0],t[1],e)}return res}var w=function(e,r){return y(e,Array.isArray(r)?r:function e(r){var t,n={IDENT:/([\w*-]+)/iy,ATTR:/([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/iy,PSEUDO:/([\w-]+)(?:\(([^)]*)\))?/iy,MODE:/\s*[:.#\[]\s*/iy,COMB:/\s*[>~+]\s*|\s+/iy},a=0,s=[],i=-1;function c(e){for(var r in a=e.lastIndex,n)n[r].lastIndex=a}function l(){var l=!1;if(t=n.COMB.exec(r)){l=!0;var u=t[0].trim();""==u&&(u=" "),s.push(u),c(n.COMB),i=a}else if(t=n.MODE.exec(r)){l=!0;var o=t[0].trim();c(n.MODE),":"==o?(t=n.PSEUDO.exec(r),s.splice(i+1,0,null!=t[2]&&"not"==t[1]?e(t[2]):t[2],t[1],o),c(n.PSEUDO)):"["==o?(t=n.ATTR.exec(r),s.splice(i+1,0,t[3],t[2],t[1],o),c(n.ATTR)):(t=n.IDENT.exec(r),s.push(t[1],o),c(n.IDENT))}else(t=n.IDENT.exec(r))&&(l=!0,s.push(t[1],"_"),c(n.IDENT));return l}for(;a<r.length;)l();return s}(r))},_=/\[([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/i,L=/:(?:first|last|nth|only|not|empty)\b/;var I=function(e){return!0};return function(e){for(var r=o(e.html,!e.keepText),t=e.shouldDrop||I,n=b(e.css.replace(d,"")),a={},s=0;s<n.length;s++)if(n[s]===v){var i=n[s+1],c=i[i.length-1];s++;for(var l=0;l<c.length;l++){var u=c[l];e:for(var f=0;f<u.length;f++){var T=u[f],E=!1,y=void 0;if(""!=T){if(T in a)E=a[T];else switch(T[0]){case"#":y=T.substr(1),a[T]=E=r.attr.has("[id="+y+"]");break;case".":y=T.substr(1),a[T]=E=r.class.has(y);break;case"[":if(T.startsWith("[type="))a[T]=E=r.attr.has(T);else{var A=T.match(_);a[T]=E=r.nodes.some(function(e){return k(e,A[1],A[3],A[2])})}break;default:a[T]=E=r.tag.has(T)}if(!E){!0===t(i[l])?i[l]=null:a[i[l]]=!0;break e}}}}}for(var N=0;N<n.length;N++)n[N]===v&&(n[++N].length,n[N]=n[N].filter(function(e){if("string"==typeof e){if(e in a)return a[e];var n=(s=e).replace(/:?:[a-z-]+/gm,function(e){return s.startsWith("::")||!L.test(e)?"":e}).replace(/:[a-z-]+\(\)/gm,"");return""==n||(n in a?a[n]:a[n]=w(r.nodes,n)||!0!==t(e))}var s;return!1}));var D=function(e){for(var r="",t=0,n=0;n<e.length;n++)switch(e[n]){case v:var a=e[++n];(t=a.length)>0&&(r+=a.join());break;case x:t>0&&(r+="{"+e[++n]+"}");break;case h:r+=e[++n]+"{";break;case p:r+="}";break;case m:r+=e[++n]}return r.replace(/@[a-z-]+\s+[^{]+\{\s*\}/gm,"")}(n);return{css:D=function(e){for(var r,t=[],n=new Set,a=/@(?:-\w+-)?keyframes\s+([\w-]+)\s*\{/gm;r=a.exec(e);){var s=g(e,a.lastIndex);t.push([r.index,r[0].length+s.length+1,r[1]])}for(var i=/animation(?:-name)?:([^;!}]+)/gm;r=i.exec(e);)r[1].trim().split(",").forEach(function(e){n.add(e.trim().match(/^[\w-]+/)[0])});for(var c,l,u,o,d=e,f=t.length-1;f>-1;f--){var h=t[f];n.has(h[2])||(c=d,l=h[0],u=h[1],o="",d=c.slice(0,l)+o+c.slice(l+u))}return d}(D)}}});
